# Совпадём - Тест на сексуальную совместимость

Проект "Совпадём" - это веб-приложение, которое позволяет парам анонимно узнать о сексуальных предпочтениях друг друга в безопасной и комфортной форме.

## Описание

Приложение предлагает пользователям пройти тест, состоящий из вопросов о сексуальных предпочтениях. После прохождения теста пользователь получает уникальную ссылку, которой может поделиться с партнером. Когда партнер также проходит тест, оба участника получают доступ к результатам, которые показывают только совпадающие предпочтения.

## Технологии

- PHP 8.2
- MySQL 8.0
- Apache
- Docker
- Docker Compose
- Phinx (для миграций)
- jQuery
- Bootstrap 5

## Установка и запуск

### Требования

- Docker
- Docker Compose
- Make (рекомендуется)

### Шаги по установке

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/sovpadem.git
cd sovpadem
```

2. Запустите контейнеры:

**Для разработки (локальная среда):**
```bash
make dev
```

**Для продакшена:**
```bash
make prod
```

Эти команды выполнят следующие действия:
- Запустят необходимые контейнеры
- Установят зависимости Composer
- Дождутся запуска базы данных
- Выполнят миграции
- Подготовят приложение к работе

3. Доступ к приложению:
- Разработка: http://localhost:8080
- Продакшен: https://sovpadem.ru

## Структура проекта

```
sovpadem/
├── db/
│   ├── migrations/    # Миграции базы данных
│   └── seeds/         # Сидеры для тестовых данных
├── docker/
│   ├── apache/
│   │   └── 000-default.conf
│   └── mysql/
│       └── my.cnf     # Настройки MySQL
├── scripts/
│   └── wait-for-db.sh # Скрипт ожидания запуска БД
├── src/
│   ├── public/
│   │   ├── css/
│   │   │   └── styles.css
│   │   ├── js/
│   │   │   └── app.js
│   │   └── index.php
│   └── templates/
│       ├── home.php
│       ├── layout.php
│       ├── partner_test.php
│       ├── results.php
│       ├── share.php
│       └── test.php
├── vendor/
├── .gitignore
├── composer.json
├── docker-compose.yml
├── Makefile          # Команды для управления проектом
├── phinx.php         # Конфигурация миграций
└── README.md
```

## Управление проектом (Makefile)

Проект включает Makefile для удобного управления. Доступные команды:

```bash
# Запуск окружения разработки
make dev

# Запуск продакшн-окружения
make prod

# Остановка всех контейнеров
make down

# Полная очистка (удаление контейнеров и томов)
make clean

# Перезапуск текущего окружения
make rebuild

# Перезапуск окружения разработки
make rebuild-dev

# Перезапуск продакшн-окружения
make rebuild-prod

# Выполнение миграций
make migrate

# Выполнение миграций в окружении разработки
make migrate-dev

# Выполнение миграций в продакшн-окружении
make migrate-prod

# Создание новой миграции
make create-migration name=MigrationName

# Откат последней миграции
make rollback

# Запуск сидеров
make seed

# Установка зависимостей Composer
make composer-install

# Ожидание доступности базы данных
make wait-for-db

# Показать список доступных команд
make help
```

## Работа с базой данных

### Миграции

Проект использует [Phinx](https://phinx.org/) для управления миграциями базы данных. Миграции находятся в директории `db/migrations/`.

**Создание новой миграции:**
```bash
make create-migration name=CreateUsersTable
```

**Выполнение миграций:**
```bash
make migrate
```

**Откат последней миграции:**
```bash
make rollback
```

### Структура базы данных

- **questions** - таблица вопросов теста
- **answer_options** - варианты ответов на вопросы
- **tests** - информация о тестах
- **user_answers** - ответы пользователей на вопросы

## Функциональность
- Прохождение теста на сексуальные предпочтения
- Генерация уникальной ссылки для партнера
- Анонимное сравнение результатов
- Отображение только совпадающих предпочтений

## Разработка

### Добавление новых вопросов

Новые вопросы можно добавить через миграцию:

```php
$this->table('questions')->insert([
    ['text' => 'Ваш новый вопрос', 'active' => true]
])->saveData();
```

### Настройка окружения

.env.default переименуйте в .env и заполните

Настройки окружения можно изменить в файле `.env` (если используется) или напрямую в `docker-compose.yml`.

## Безопасность

Все данные хранятся анонимно, без привязки к личной информации пользователей. Доступ к результатам возможен только по уникальным ссылкам.

## Решение проблем

### База данных недоступна

Если при запуске возникают ошибки связи с базой данных:
```bash
# Проверьте статус контейнера базы данных
docker ps

# Проверьте логи контейнера
docker logs sovpadem_db_dev

# Перезапустите окружение
make rebuild-dev
```

### Проблемы с миграциями

Если миграции не выполняются:
```bash
# Откатите все миграции и выполните их заново
make rollback
make migrate

# Или перезапустите все окружение
make rebuild
```

## Лицензия

Все права защищены. Данный проект является интеллектуальной собственностью автора. Копирование, распространение или использование кода без явного письменного разрешения автора запрещено.

## Контакты

Для вопросов и предложений: https://lyucean.com